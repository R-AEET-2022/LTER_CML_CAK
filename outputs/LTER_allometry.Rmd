---
title: "LTER_allometry"
author: "CML & CAK"
date: "2022-09-22"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

We selected the and_vertebrates database from the LTER site ( https://lter.github.io/lterdatasampler/reference/and_vertebrates.html):

The dataset includes count and size data for cutthroat trout and salamanders in 
clear cut or old growth sections of Mack Creek, Andrews Forest LTER.

```{r load libraries and import and open data, echo=FALSE}

library(here) #refiere la ruta a la carpeta del proyecto
library(tidyverse) #incluye la librería ggplot2
library(ggplot2) #VISUALIZACIÓN DE DATOS
library(RColorBrewer) #paletas de color
library(plotly) #hacer los gráficos interactivos
library(patchwork) #combinar gráficos de ggplot
library(tidyverse)
library(readr) #leer archivos
library(readxl) #leer archivos excel
library(dplyr) #manipular datos
library(tidyr) #ordenar y trasformar datasets
library(stringr) #manipular caracteres
library(forcats) #manipular factores
library(lubridate) #manipular fechas
library("easystats")
library("effects")
library("equatiomatic")
library("parameters")
library("report")
library("visreg")
library("performance")
library("DHARMa")
library("modelbased")
library(remotes)

remotes::install_github("lter/lterdatasampler")  #Solo necesario para la descarga de internet
ourdata <- lterdatasampler::and_vertebrates ## Esto se hace solo una vez, descarga de internet
write.csv(ourdata, file = here("data/ourdata.csv"))
ourdata <- read_csv("data/ourdata.csv")
View(ourdata)

```

## Plot the raw data

In this case, we are interested in modeling  the length-mass relationships for cutthroat
trout and salamanders in Mack Creek:

```{r plot raw data, echo=FALSE}

ourdata$species <- as.factor(ourdata$species)
ggplot(ourdata, aes(x = length_1_mm,
                    y = weight_g,
                    color = species)) +
  geom_point()
```

There are three species sampled but the Cascade torrent salamander is almost
absent from the dataset, so we decided to ignore this species from our analysis.

First we subsampled the dataset and then plotted it:

```{r subsample the dataset}

data_species2 <- ourdata %>%
  subset(species != "Cascade torrent salamander")

data_species2$species <- as.factor(data_species2$species)
ggplot(data_species2, aes(x = length_1_mm,
                    y = weight_g,
                    color = species)) +
  geom_point()

```

The relationship between length and weight of these species is exponential,
thus we decided to transform our variables into logarithm (we checked log2
for length and log10 for biomass)

The reason for log10 transform the biomass is because we have many small values 
(near zero) and wanted to enlarge the distribution "scale"


```{r transform x,y data and plot it}
data_species_log <- data_species2
data_species_log$log_length1 <- log10(data_species_log$length_1_mm)
data_species_log$log_weight <- log10(data_species_log$weight_g)

ggplot(data_species_log, aes(x = log_length1,
                             y = log_weight,
                             color = species)) +
  geom_point()

```

Result: It worked the relationship is almost linear.
We CAN NOW MODEL THIS RELATIONSHIP--- ME QUEDO AQUI CARLOS
te dejo los modelos habria que ponerlos por separado,  hacerles el summary, etc
y comentarlos

```{r}
lm_log_species <- lm(log_weight ~ log_length1 + species, data=data_species_log)
plot(lm_log_species)

lm_log_species_i <- lm(log_weight ~ log_length1 * species, data=data_species_log)
plot(lm_log_species_i)
ad
check_model(lm_log_species_i)
```



